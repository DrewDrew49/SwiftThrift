<?php
include('header.php');
?>

<div class='row'>
	<!--Side Bar-->
	<div class="col-md-2">
		<?php include('sidebar.php'); ?>
	</div>
	
	<!--Left Frame-->
	<div class='col-sm-10' style='margin-left: -10px'>
		<!--search bar-->
		<div class='row'>
			<?php include('searchbar.php'); ?>
		</div>

		<!--Main Content-->
		<div class='row'>

			<?php
			$id = (int) @$_GET['item'];

			if(!empty($id) && is_numeric($id) && $id >= 1) {
				$item = ItemHandler::getUnpublishedItemWithId($id);
			} else {
				$item = null;
			}
			?>
			
			<?php
			if($item != null) {
				// Need to change to return to results.php when search is used
				echo "<p><font size='4'><a href='category.php?id={$item->getCategory()}'>&laquo; Back to Listings</a></font></p>";
				$seller = UserHandler::getUserWithId((int) $item->getSellerId());

				echo "
				<div class='panel panel-default'>
					<div class='panel-heading'>
						<p><font size='6'>{$item->getTitle()}</font></p>
					</div>

					<div class='panel-body'>
						<table class='table'>
							<div class='row'>
								<div class='col-md-3'>
									
									<a href='{$item->getImgPath()}' target='_blank'>
									<h3><img width='200' src='{$item->getImgPath()}' alt='No Image'></h3>
									<p class='text-center'>Click to view full image</p></a>
								</div>

								<div class='col-md-9'>
									<p><font size='4'><strong>Seller: </strong>{$seller->getUsername()}</font></p>
									<p><font size='4'><strong>Date Posted: </strong>{$item->getPostedTimestamp()}</font></p>
									<p><font size='5'>{$item->getPrice()}</font></p>
									<p><a href='send_message.php?item={$item->getId()}'><button type='button' class='btn btn-primary btn-lg'>Contact Seller to Buy</button></a></p>
								</div>
							</div>

							<tr><td>
								<p><font size='4'><strong>Keywords:</strong></font> {$item->getKeywords()}</p>
							</td></tr>

							<tr><td>
								<p><font size='4'><strong>Item Description:</strong></font></p>
								<p>{$item->getDescription()}</p>
							</td></tr>
						</table>
					</div>
				</div>
				";
			} else { // If an invalid item id is entered
				echo "
				<p><font size='4'><a href='index.php'>&laquo; Back to Home</a></font></p>

				<div class='panel panel-default'>
					<div class='panel-heading'>
						<p class='lead text-center'>Listing not found. Please go back and try again.</p>
					</div>
				</div>
				";
			}
			?>

		</div>
	</div>
</div>

<?php
include('footer.php');
?>
